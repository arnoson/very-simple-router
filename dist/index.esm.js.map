{"version":3,"file":"index.esm.js","sources":["../src/utils.js","../src/Route.js","../src/Router.js"],"sourcesContent":["/**\n * Remove a trailing slash from an url if its not root url (`/`).\n * @param {string} str\n */\nexport const stripTrailingSlash = str =>\n  str.length > 1 && str.endsWith('/') ? str.slice(0, -1) : str\n","import { stripTrailingSlash } from './utils.js'\n\n/**\n * @typedef {Object<string, string>} RouteParams\n */\n\n/**\n * @typedef {(params: RouteParams) => any} RouteAction\n */\n\n/**\n * @private\n */\nexport class Route {\n  /**\n   * @param {string} path\n   * @param {RouteAction} action\n   */\n  constructor(path, action) {\n    path = stripTrailingSlash(path)\n\n    this.path = path\n    this.action = action\n    this.catchAll = path === '*'\n\n    const { regExp, keys } = this._parsePattern(path) || {}\n    this.regExp = regExp\n    this.keys = keys\n  }\n\n  /**\n   * @private\n   * @param {string} pattern\n   * @returns {{ keys: Array<string>, regExp: RegExp }}\n   */\n  _parsePattern(pattern) {\n    const keys = pattern.match(/(:[^/]+)/g)?.map(name => name.substr(1))\n    return (\n      keys && {\n        keys,\n        regExp: new RegExp('^' + pattern.replace(/(:[^/]+)/g, '([^/]+)') + '$')\n      }\n    )\n  }\n\n  /**\n   * @param {string} path\n   * @returns {RouteParams | undefined}\n   */\n  match(path) {\n    return (\n      path !== undefined &&\n      (this.regExp\n        ? this._getParams(path.match(this.regExp))\n        : (this.catchAll || path === this.path) && {})\n    )\n  }\n\n  /**\n   * @private\n   * @param {Array<string>} match\n   * @return {RouteParams | undefined}\n   */\n  _getParams(match) {\n    if (match) {\n      /** @type {RouteParams} */\n      const params = {}\n      this.keys.forEach(\n        // The first element in `match` contains the whole string so we have to\n        // offset the index by 1.\n        (key, index) => (params[key] = match[index + 1])\n      )\n      return params\n    }\n  }\n}\n","import { stripTrailingSlash } from './utils.js'\nimport { Route } from './Route.js'\n\nexport class Router {\n  /**\n   * @param {{ routes?: Array, scrollRestoration?: ScrollRestoration }} [options]\n   */\n  // @ts-ignore (typescript doesn't seem to like the empty `{}`)\n  constructor({ routes = [], scrollRestoration = 'manual' } = {}) {\n    /** @type {Array<Route>} */\n    this.routes = []\n    /** @type {{ path: string, params: object }} */\n    this.currentRoute = null\n\n    routes.forEach(({ path, action }) => this.route(path, action))\n    window.history.scrollRestoration = scrollRestoration\n    window.addEventListener('popstate', () =>\n      this._handleChange(window.location.pathname)\n    )\n  }\n\n  /**\n   * Add a new route.\n   * @param {string} path - A path or a pattern (e.g.: `/user/:id`).\n   * @param {import(\"./Route\").RouteAction} action A function that is called\n   * when the route is entered. The route parameters are passed as object.\n   */\n  route(path, action) {\n    this.routes.push(new Route(path, action))\n  }\n\n  /**\n   * Push a new route.\n   * @param {string} path\n   */\n  push(path) {\n    window.history.pushState(null, null, stripTrailingSlash(path))\n    this._handleChange(path)\n  }\n\n  /**\n   * Replace current route with a new route.\n   * @param {string} path\n   */\n  replace(path) {\n    window.history.replaceState(null, null, stripTrailingSlash(path))\n    this._handleChange(path)\n  }\n\n  /**\n   * Search for the first route that matches the path and call the routes\n   * callback.\n   * @private\n   * @param {string} path\n   */\n  _handleChange(path) {\n    for (const route of this.routes) {\n      const params = route.match(path)\n      if (params) {\n        this.currentRoute = { path, params }\n        route.action(params)\n        break\n      }\n    }\n  }\n}\n"],"names":["stripTrailingSlash","str","length","endsWith","slice","Route","[object Object]","path","action","this","catchAll","regExp","keys","_parsePattern","pattern","match","map","name","substr","RegExp","replace","undefined","_getParams","params","forEach","key","index","routes","scrollRestoration","currentRoute","route","window","history","addEventListener","_handleChange","location","pathname","push","pushState","replaceState"],"mappings":"AAIO,MAAMA,EAAqBC,GAChCA,EAAIC,OAAS,GAAKD,EAAIE,SAAS,KAAOF,EAAIG,MAAM,GAAI,GAAKH,ECQpD,MAAMI,EAKXC,YAAYC,EAAMC,GAChBD,EAAOP,EAAmBO,GAE1BE,KAAKF,KAAOA,EACZE,KAAKD,OAASA,EACdC,KAAKC,SAAoB,MAATH,EAEhB,MAAMI,OAAEA,EAAMC,KAAEA,GAASH,KAAKI,cAAcN,IAAS,GACrDE,KAAKE,OAASA,EACdF,KAAKG,KAAOA,EAQdN,cAAcQ,GACZ,MAAMF,EAAOE,EAAQC,MAAM,cAAcC,KAAIC,GAAQA,EAAKC,OAAO,KACjE,OACEN,GAAQ,CACNA,KAAAA,EACAD,OAAQ,IAAIQ,OAAO,IAAML,EAAQM,QAAQ,YAAa,WAAa,MASzEd,MAAMC,GACJ,YACWc,IAATd,IACCE,KAAKE,OACFF,KAAKa,WAAWf,EAAKQ,MAAMN,KAAKE,UAC/BF,KAAKC,UAAYH,IAASE,KAAKF,OAAS,IASjDD,WAAWS,GACT,GAAIA,EAAO,CAET,MAAMQ,EAAS,GAMf,OALAd,KAAKG,KAAKY,SAGR,CAACC,EAAKC,IAAWH,EAAOE,GAAOV,EAAMW,EAAQ,KAExCH,mBCrEN,MAKLjB,aAAYqB,OAAEA,EAAS,GAAEC,kBAAEA,EAAoB,UAAa,IAE1DnB,KAAKkB,OAAS,GAEdlB,KAAKoB,aAAe,KAEpBF,EAAOH,SAAQ,EAAGjB,KAAAA,EAAMC,OAAAA,KAAaC,KAAKqB,MAAMvB,EAAMC,KACtDuB,OAAOC,QAAQJ,kBAAoBA,EACnCG,OAAOE,iBAAiB,YAAY,IAClCxB,KAAKyB,cAAcH,OAAOI,SAASC,YAUvC9B,MAAMC,EAAMC,GACVC,KAAKkB,OAAOU,KAAK,IAAIhC,EAAME,EAAMC,IAOnCF,KAAKC,GACHwB,OAAOC,QAAQM,UAAU,KAAM,KAAMtC,EAAmBO,IACxDE,KAAKyB,cAAc3B,GAOrBD,QAAQC,GACNwB,OAAOC,QAAQO,aAAa,KAAM,KAAMvC,EAAmBO,IAC3DE,KAAKyB,cAAc3B,GASrBD,cAAcC,GACZ,IAAK,MAAMuB,KAASrB,KAAKkB,OAAQ,CAC/B,MAAMJ,EAASO,EAAMf,MAAMR,GAC3B,GAAIgB,EAAQ,CACVd,KAAKoB,aAAe,CAAEtB,KAAAA,EAAMgB,OAAAA,GAC5BO,EAAMtB,OAAOe,GACb"}