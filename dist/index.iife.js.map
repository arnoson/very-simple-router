{"version":3,"file":"index.iife.js","sources":["../src/utils.js","../src/Route.js","../src/Router.js"],"sourcesContent":["/**\n * Remove a trailing slash from an url if its not root url (`/`).\n * @param {string} str\n */\nexport const stripTrailingSlash = str =>\n  str.length > 1 && str.endsWith('/') ? str.slice(0, -1) : str\n","import { stripTrailingSlash } from './utils.js'\n\n/**\n * @typedef {Object<string, string>} RouteParams\n */\n\n/**\n * @typedef {(params: RouteParams, initial?: boolean) => any} RouteAction\n */\n\n/**\n * @private\n */\nexport class Route {\n  /**\n   * @param {string} path\n   * @param {RouteAction} action\n   */\n  constructor(path, action) {\n    path = stripTrailingSlash(path)\n\n    this.path = path\n    this.pattern = path\n    this.action = action\n    this.catchAll = path === '*'\n\n    const { regExp, keys } = this._parsePattern(path) || {}\n    this.regExp = regExp\n    this.keys = keys\n  }\n\n  /**\n   * @private\n   * @param {string} pattern\n   * @returns {{ keys: Array<string>, regExp: RegExp }}\n   */\n  _parsePattern(pattern) {\n    const keys = pattern.match(/(:[^/]+)/g)?.map(name => name.substr(1))\n    return (\n      keys && {\n        keys,\n        regExp: new RegExp('^' + pattern.replace(/(:[^/]+)/g, '([^/]+)') + '$')\n      }\n    )\n  }\n\n  /**\n   * @param {string} path\n   * @returns {RouteParams | undefined}\n   */\n  match(path) {\n    return (\n      path !== undefined &&\n      (this.regExp\n        ? this._getParams(path.match(this.regExp))\n        : (this.catchAll || path === this.path) && {})\n    )\n  }\n\n  /**\n   * @private\n   * @param {Array<string>} match\n   * @return {RouteParams | undefined}\n   */\n  _getParams(match) {\n    if (match) {\n      /** @type {RouteParams} */\n      const params = {}\n      this.keys.forEach(\n        // The first element in `match` contains the whole string so we have to\n        // offset the index by 1.\n        (key, index) => (params[key] = match[index + 1])\n      )\n      return params\n    }\n  }\n}\n","import { stripTrailingSlash } from './utils.js'\nimport { Route } from './Route.js'\n\n/** @typedef {{ path: string, pattern: string, params: object }} RouteObject */\n\nexport class Router {\n  /**\n   * @param {{ routes?: Array, scrollRestoration?: ScrollRestoration }} [options]\n   */\n  // @ts-ignore (typescript doesn't seem to like the empty `{}`)\n  constructor({ routes = [], scrollRestoration = 'manual' } = {}) {\n    /** @type {Array<Route>} */\n    this.routes = []\n    /** @type {RouteObject} */\n    this.currentRoute = null\n\n    this._handleBeforeEach = null\n    this._handleAfterEach = null\n\n    routes.forEach(({ path, action }) => this.route(path, action))\n    window.history.scrollRestoration = scrollRestoration\n    window.addEventListener('popstate', () =>\n      this._handleChange(window.location.pathname)\n    )\n  }\n\n  /**\n   * Add a new route.\n   * @param {string} path - A path or a pattern (e.g.: `/user/:id`).\n   * @param {import(\"./Route\").RouteAction} action A function that is called\n   * when the route is entered. The route parameters are passed as object.\n   */\n  route(path, action) {\n    this.routes.push(new Route(path, action))\n  }\n\n  /**\n   * Push a new route.\n   * @param {string} path\n   */\n  push(path) {\n    window.history.pushState(null, null, stripTrailingSlash(path))\n    this._handleChange(path)\n  }\n\n  /**\n   * Replace current route with a new route.\n   * @param {string} path\n   */\n  replace(path) {\n    window.history.replaceState(null, null, stripTrailingSlash(path))\n    this._handleChange(path)\n  }\n\n  init() {\n    this._handleChange(window.location.pathname, true)\n  }\n\n  /**\n   * @param {(route: RouteObject) => any?} callback\n   */\n  beforeEach(callback) {\n    this._handleBeforeEach = callback\n  }\n\n  /**\n   * @param {(route: RouteObject) => any?} callback\n   */\n  afterEach(callback) {\n    this._handleAfterEach = callback\n  }\n\n  /**\n   * Search for the first route that matches the path and call the routes\n   * callback.\n   * @private\n   * @param {string} path\n   * @param {boolean} initial\n   */\n  _handleChange(path, initial = false) {\n    for (const route of this.routes) {\n      const params = route.match(path)\n      if (params) {\n        const { pattern } = route\n        this.currentRoute = { path, pattern, params }\n\n        this._handleBeforeEach?.(this.currentRoute)\n\n        const result = route.action(params, initial)\n        if (result instanceof Promise) {\n          result.then(() => this._handleAfterEach?.(this.currentRoute))\n        } else {\n          this._handleAfterEach?.(this.currentRoute)\n        }\n        break\n      }\n    }\n  }\n}\n"],"names":["stripTrailingSlash","str","length","endsWith","slice","Route","path","action","pattern","catchAll","this","_parsePattern","regExp","keys","match","_pattern$match","map","name","substr","RegExp","replace","undefined","_getParams","params","forEach","key","index","routes","scrollRestoration","currentRoute","_handleBeforeEach","_handleAfterEach","_this","route","window","history","addEventListener","_handleChange","location","pathname","push","pushState","replaceState","callback","initial","result","Promise","then","_this2","_this2$_handleAfterEa"],"mappings":"o2CAIO,IAAMA,EAAqB,SAAAC,UAChCA,EAAIC,OAAS,GAAKD,EAAIE,SAAS,KAAOF,EAAIG,MAAM,GAAI,GAAKH,GCQ9CI,wBAKCC,EAAMC,aAChBD,EAAON,EAAmBM,QAErBA,KAAOA,OACPE,QAAUF,OACVC,OAASA,OACTE,SAAoB,MAATH,QAESI,KAAKC,cAAcL,IAAS,GAA7CM,IAAAA,OAAQC,IAAAA,UACXD,OAASA,OACTC,KAAOA,yCAQd,SAAcL,SACNK,YAAOL,EAAQM,MAAM,iCAAdC,EAA4BC,KAAI,SAAAC,UAAQA,EAAKC,OAAO,aAE/DL,GAAQ,CACNA,KAAAA,EACAD,OAAQ,IAAIO,OAAO,IAAMX,EAAQY,QAAQ,YAAa,WAAa,2BASzE,SAAMd,eAEOe,IAATf,IACCI,KAAKE,OACFF,KAAKY,WAAWhB,EAAKQ,MAAMJ,KAAKE,UAC/BF,KAAKD,UAAYH,IAASI,KAAKJ,OAAS,8BASjD,SAAWQ,MACLA,EAAO,KAEHS,EAAS,eACVV,KAAKW,kBAGPC,EAAKC,UAAWH,EAAOE,GAAOX,EAAMY,EAAQ,MAExCH,+GC/DiD,OAA9CI,OAAAA,aAAS,SAAIC,kBAAAA,aAAoB,0BAExCD,OAAS,QAETE,aAAe,UAEfC,kBAAoB,UACpBC,iBAAmB,KAExBJ,EAAOH,SAAQ,gBAAGlB,IAAAA,KAAMC,IAAAA,cAAayB,EAAKC,MAAM3B,EAAMC,MACtD2B,OAAOC,QAAQP,kBAAoBA,EACnCM,OAAOE,iBAAiB,YAAY,kBAClCJ,EAAKK,cAAcH,OAAOI,SAASC,4CAUvC,SAAMjC,EAAMC,QACLoB,OAAOa,KAAK,IAAInC,EAAMC,EAAMC,wBAOnC,SAAKD,GACH4B,OAAOC,QAAQM,UAAU,KAAM,KAAMzC,EAAmBM,SACnD+B,cAAc/B,0BAOrB,SAAQA,GACN4B,OAAOC,QAAQO,aAAa,KAAM,KAAM1C,EAAmBM,SACtD+B,cAAc/B,uBAGrB,gBACO+B,cAAcH,OAAOI,SAASC,UAAU,6BAM/C,SAAWI,QACJb,kBAAoBa,2BAM3B,SAAUA,QACHZ,iBAAmBY,+BAU1B,SAAcrC,gBAAMsC,8DACElC,KAAKiB,uCAAQ,KAAtBM,UACHV,EAASU,EAAMnB,MAAMR,MACvBiB,EAAQ,OACFf,EAAYyB,EAAZzB,aACHqB,aAAe,CAAEvB,KAAAA,EAAME,QAAAA,EAASe,OAAAA,kBAEhCO,4CAAoBpB,KAAKmB,oBAExBgB,EAASZ,EAAM1B,OAAOgB,EAAQqB,MAChCC,aAAkBC,QACpBD,EAAOE,MAAK,kCAAMC,EAAKjB,qCAALkB,OAAAD,EAAwBA,EAAKnB,qCAE1CE,2CAAmBrB,KAAKmB"}